import networkx as nx
import time
import ELOD


def show(G, subgraph=None):
    import matplotlib.pyplot as plt
    nx.draw(G, with_labels=True, node_size=150, width=1.0,
            node_color=[1 if subgraph is None or v in subgraph else 0 for v in G.nodes()],
            edge_color=[1 if subgraph is None or subgraph.has_edge(v,u) else 0 for v,u in G.edges()],
            node_cmap=plt.cm.rainbow,
            edge_cmap=plt.cm.rainbow )
    plt.show()


#evaluate GW https://arxiv.org/pdf/1908.05767.pdf, optimal value 0.7632


core_trace_conductance = list()
core_pcst_conductance = list()
core_trace_a = list()
core_pcst_a = list()
core_trace_time = list()
core_pcst_time = list()
trace_time = list()
pcst_time = list()
trace_ELOD = list()
pcst_ELOD = list()


for _ in range(100):
    G = nx.erdos_renyi_graph(100, 0.1, seed=2).to_directed()
    r = list(G.nodes)[0]

    tic = time.time()
    T, trace_a = ELOD.core(G, r, ELOD.trace)
    core_trace_time.append(time.time()-tic)
    tic = time.time()
    W, pcst_a = ELOD.core(G, r, ELOD.pcst)
    core_pcst_time.append(time.time()-tic)

    core_trace_conductance.append(ELOD.conductance(G, T))
    core_pcst_conductance.append(ELOD.conductance(G, W))

    core_trace_a.append(trace_a)
    core_pcst_a.append(pcst_a)

    found_a = min(trace_a, pcst_a)

    tic = time.time()
    T = ELOD.trace(G, r, found_a)
    trace_time.append(time.time()-tic)
    tic = time.time()
    W = ELOD.pcst(G, r, found_a)
    pcst_time.append(time.time()-tic)

    trace_ELOD.append(ELOD.ELOD(G, T, found_a))
    pcst_ELOD.append(ELOD.ELOD(G, W, found_a))

print('Core trace conductance')
print(core_trace_conductance)
print('Core PCST conductance')
print(core_pcst_conductance)

print('Core trace a')
print(core_trace_a)
print('Core PCST a')
print(core_pcst_a)

print('Core trace time')
print(core_trace_time)
print('Core PCST time')
print(core_trace_time)

print('Trace time')
print(trace_time)
print('PCST time')
print(pcst_time)

print('Trace ELOD')
print(trace_ELOD)
print('PCST ELOD')
print(pcst_ELOD)

"""
EXAMPLE RESULS
Core trace conductance
[15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332, 15.833333333333332]
Core PCST conductance
[11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692, 11.692307692307692]
Core trace a
[14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421, 14.31578947368421]
Core PCST a
[11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76, 11.76]
Core trace time
[0.08134222030639648, 0.08436012268066406, 0.08237600326538086, 0.08058953285217285, 0.08072113990783691, 0.09444522857666016, 0.08179974555969238, 0.08063292503356934, 0.09533810615539551, 0.08578276634216309, 0.08223247528076172, 0.10193181037902832, 0.09071850776672363, 0.08173036575317383, 0.09426426887512207, 0.0818023681640625, 0.08198809623718262, 0.08178973197937012, 0.08011078834533691, 0.08475136756896973, 0.08246326446533203, 0.08075881004333496, 0.08135080337524414, 0.08046627044677734, 0.08147192001342773, 0.0806732177734375, 0.08013701438903809, 0.09194064140319824, 0.08065342903137207, 0.0812222957611084, 0.09259724617004395, 0.08154296875, 0.08043432235717773, 0.09612298011779785, 0.08347487449645996, 0.08094120025634766, 0.09377408027648926, 0.0950477123260498, 0.08055377006530762, 0.09374570846557617, 0.0810394287109375, 0.0806124210357666, 0.08204317092895508, 0.08170747756958008, 0.09066605567932129, 0.0840153694152832, 0.08104062080383301, 0.08118224143981934, 0.08075737953186035, 0.08041095733642578, 0.08110880851745605, 0.08088088035583496, 0.07968330383300781, 0.09468555450439453, 0.09901785850524902, 0.10169696807861328, 0.08358621597290039, 0.11209964752197266, 0.08408355712890625, 0.08448314666748047, 0.08274483680725098, 0.08382058143615723, 0.09537529945373535, 0.08284544944763184, 0.08306336402893066, 0.08191299438476562, 0.08295178413391113, 0.09448480606079102, 0.0842738151550293, 0.08305525779724121, 0.09526443481445312, 0.08177018165588379, 0.0838932991027832, 0.08312535285949707, 0.08365464210510254, 0.0831763744354248, 0.08360743522644043, 0.08437824249267578, 0.0825510025024414, 0.08344292640686035, 0.08333563804626465, 0.09500360488891602, 0.0829925537109375, 0.08214187622070312, 0.09443283081054688, 0.08088803291320801, 0.08189511299133301, 0.08236098289489746, 0.08186101913452148, 0.08295083045959473, 0.08342838287353516, 0.0847477912902832, 0.08261561393737793, 0.08194327354431152, 0.08181262016296387, 0.0862569808959961, 0.08188891410827637, 0.0831608772277832, 0.09195923805236816, 0.08187508583068848]
Core PCST time
[0.08134222030639648, 0.08436012268066406, 0.08237600326538086, 0.08058953285217285, 0.08072113990783691, 0.09444522857666016, 0.08179974555969238, 0.08063292503356934, 0.09533810615539551, 0.08578276634216309, 0.08223247528076172, 0.10193181037902832, 0.09071850776672363, 0.08173036575317383, 0.09426426887512207, 0.0818023681640625, 0.08198809623718262, 0.08178973197937012, 0.08011078834533691, 0.08475136756896973, 0.08246326446533203, 0.08075881004333496, 0.08135080337524414, 0.08046627044677734, 0.08147192001342773, 0.0806732177734375, 0.08013701438903809, 0.09194064140319824, 0.08065342903137207, 0.0812222957611084, 0.09259724617004395, 0.08154296875, 0.08043432235717773, 0.09612298011779785, 0.08347487449645996, 0.08094120025634766, 0.09377408027648926, 0.0950477123260498, 0.08055377006530762, 0.09374570846557617, 0.0810394287109375, 0.0806124210357666, 0.08204317092895508, 0.08170747756958008, 0.09066605567932129, 0.0840153694152832, 0.08104062080383301, 0.08118224143981934, 0.08075737953186035, 0.08041095733642578, 0.08110880851745605, 0.08088088035583496, 0.07968330383300781, 0.09468555450439453, 0.09901785850524902, 0.10169696807861328, 0.08358621597290039, 0.11209964752197266, 0.08408355712890625, 0.08448314666748047, 0.08274483680725098, 0.08382058143615723, 0.09537529945373535, 0.08284544944763184, 0.08306336402893066, 0.08191299438476562, 0.08295178413391113, 0.09448480606079102, 0.0842738151550293, 0.08305525779724121, 0.09526443481445312, 0.08177018165588379, 0.0838932991027832, 0.08312535285949707, 0.08365464210510254, 0.0831763744354248, 0.08360743522644043, 0.08437824249267578, 0.0825510025024414, 0.08344292640686035, 0.08333563804626465, 0.09500360488891602, 0.0829925537109375, 0.08214187622070312, 0.09443283081054688, 0.08088803291320801, 0.08189511299133301, 0.08236098289489746, 0.08186101913452148, 0.08295083045959473, 0.08342838287353516, 0.0847477912902832, 0.08261561393737793, 0.08194327354431152, 0.08181262016296387, 0.0862569808959961, 0.08188891410827637, 0.0831608772277832, 0.09195923805236816, 0.08187508583068848]
Trace time
[0.0156557559967041, 0.016808509826660156, 0.015671253204345703, 0.01567387580871582, 0.01566290855407715, 0.016350984573364258, 0.015757322311401367, 0.015186071395874023, 0.015537261962890625, 0.015827417373657227, 0.015386581420898438, 0.015436887741088867, 0.016005516052246094, 0.0157163143157959, 0.015370845794677734, 0.016163110733032227, 0.015644073486328125, 0.015091180801391602, 0.016674518585205078, 0.015909671783447266, 0.015486001968383789, 0.016077280044555664, 0.015804052352905273, 0.015490055084228516, 0.015799760818481445, 0.015072822570800781, 0.015804529190063477, 0.015929460525512695, 0.015117645263671875, 0.015590667724609375, 0.015600204467773438, 0.015975236892700195, 0.015768766403198242, 0.016630172729492188, 0.01548147201538086, 0.015854597091674805, 0.015144586563110352, 0.01520538330078125, 0.015679121017456055, 0.015176534652709961, 0.015711307525634766, 0.0156857967376709, 0.015552043914794922, 0.0152587890625, 0.01775979995727539, 0.016180753707885742, 0.015172243118286133, 0.017901182174682617, 0.015140533447265625, 0.015099287033081055, 0.0159761905670166, 0.015642166137695312, 0.015073537826538086, 0.015429496765136719, 0.0164945125579834, 0.016879796981811523, 0.016805410385131836, 0.0163114070892334, 0.015327215194702148, 0.015515565872192383, 0.015789270401000977, 0.01547098159790039, 0.01625680923461914, 0.015819549560546875, 0.015926599502563477, 0.015403270721435547, 0.015891075134277344, 0.016594886779785156, 0.01581597328186035, 0.016194581985473633, 0.016299962997436523, 0.016307353973388672, 0.02303314208984375, 0.01609635353088379, 0.015700578689575195, 0.015758275985717773, 0.015942811965942383, 0.016009807586669922, 0.016910076141357422, 0.01621389389038086, 0.015860795974731445, 0.015791654586791992, 0.015663862228393555, 0.015284061431884766, 0.016164064407348633, 0.015930891036987305, 0.015807628631591797, 0.015512466430664062, 0.016167879104614258, 0.015874624252319336, 0.01585078239440918, 0.0157473087310791, 0.028034448623657227, 0.015430688858032227, 0.015599489212036133, 0.01651477813720703, 0.015569210052490234, 0.01614665985107422, 0.015666961669921875, 0.015516281127929688]
PCST time
[0.008901119232177734, 0.008423089981079102, 0.009154319763183594, 0.009571552276611328, 0.008362531661987305, 0.008440494537353516, 0.008014917373657227, 0.008235931396484375, 0.008522748947143555, 0.008776187896728516, 0.008286237716674805, 0.008938074111938477, 0.008540153503417969, 0.008154153823852539, 0.008246421813964844, 0.008365869522094727, 0.00808405876159668, 0.008335590362548828, 0.01923966407775879, 0.008268594741821289, 0.008510828018188477, 0.008955001831054688, 0.00819540023803711, 0.008243083953857422, 0.008268594741821289, 0.008052825927734375, 0.008447408676147461, 0.008306503295898438, 0.008771657943725586, 0.008115053176879883, 0.008590936660766602, 0.008313894271850586, 0.008711814880371094, 0.008533954620361328, 0.008224964141845703, 0.008107662200927734, 0.008852243423461914, 0.00868988037109375, 0.008221149444580078, 0.009063482284545898, 0.008347034454345703, 0.008106708526611328, 0.008756160736083984, 0.008337736129760742, 0.01843547821044922, 0.008452177047729492, 0.00805354118347168, 0.00852346420288086, 0.008811473846435547, 0.008460283279418945, 0.008650779724121094, 0.00827646255493164, 0.008154630661010742, 0.012372732162475586, 0.016925573348999023, 0.00841212272644043, 0.011165380477905273, 0.009327173233032227, 0.008662223815917969, 0.008427619934082031, 0.01051950454711914, 0.008150577545166016, 0.008425474166870117, 0.00870966911315918, 0.008281946182250977, 0.008193016052246094, 0.008104324340820312, 0.009701013565063477, 0.008370399475097656, 0.00897669792175293, 0.008848190307617188, 0.008793354034423828, 0.014140605926513672, 0.009076833724975586, 0.008827447891235352, 0.008884429931640625, 0.008513450622558594, 0.009816408157348633, 0.00896143913269043, 0.008530139923095703, 0.009211301803588867, 0.008763313293457031, 0.008548974990844727, 0.008893251419067383, 0.008554220199584961, 0.008540153503417969, 0.008500099182128906, 0.008898258209228516, 0.008395910263061523, 0.008303403854370117, 0.008503198623657227, 0.00844883918762207, 0.008449554443359375, 0.008826732635498047, 0.008628368377685547, 0.008545875549316406, 0.008229970932006836, 0.008177518844604492, 0.00868535041809082, 0.00840449333190918]
Trace ELOD
[48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0, 48.0]
PCST ELOD
[24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001, 24.24000000000001]

"""






